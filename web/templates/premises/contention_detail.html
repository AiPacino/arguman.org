{% extends "base.html" %}
{% load static %}

{% block header %}
    <header class="sticky-header">
        <div id="logo"><a href="/"><img src="{% static "img/logo.png" %}" /></a></div>
        <nav>
            <ul>
                <li>
                    ekleyen: <a href="#">{{ contention.user }}</a>
                </li>
                <li>
                    orijinal söylem:
                    {% if contention.sources %}
                    {{ contention.sources|urlize }}
                    {% else %}
                     Belirtilmemiş
                    {% endif %}
                </li>
            </ul>
        </nav>
    </header>
{% endblock %}

{% block content %}
    <!-- templates -->
    <script id="main-contention-template" type="text/template">
        <div class="main-premise-content">
            <%= marked(name) %>
        </div>
    </script>

    <script id="premise-template" type="text/template">
        <div class="premise-type <%= premise_type %>">
            <%= {"but": "ama", "because": "çünkü", "however": "ancak"}[premise_type] %>
        </div>
        <div class="premise-content <%= premise_type %>">
            <%= marked(name) %>
        </div>
        <% if (sources) { %>
        <div class="premise-sources">
        <strong>kaynaklar:</strong>
        <%= marked(sources) %>
        </div>
        <% } %>
    </script>

    <div id="app"></div>
    <div class="story" id="contention-story">
        <!--
            Simplified version (just an unordered list)
            Does not affects the interactive map.
            It was done for by crawlers and browsers which disabled javascript.
        -->
        <ul class="main-contention">
            <li>
                <div class="premise {{ premise.premise_class }}">
                    <div class="contention premise-content">
                    {{ contention.title }}
                </div>
                {% if user.is_authenticated %}
                    <div class="contention-actions">
                    <form action="{% url "new_premise" contention.slug %}" method="get">
                    <input type="submit" value="önerme ekle"/>
                    </form>
                </div>
                {% endif %}
                </div>
                <ul class="tree">
                    {% for premise in contention.published_premises.all %}
                    <li class="base-premise">
                        <div class="premise {{ premise.premise_class }}">
                            <div class="premise-content">
                                {{ premise.text }}
                            </div>
                            {% if user.is_authenticated %}
                            <div class="actions">
                                {% include "premises/actions.html" %}
                            </div>
                            {% endif %}
                        </div>
                        {% if premise.children.exists %}
                            {% with template_name="premises/tree_view.html" %}
                                {% include template_name %}
                            {% endwith %}
                        {% endif %}
                    </li>
                    {% empty %}
                    <li class="new-premise">Henüz hiç ama'sı ya da çünkü'sü yok</li>
                    {% endfor %}
                </ul>
            </li>
        </ul>
        <!-- End of simplified version -->
    </div>
{% endblock %}

{% block extra-scripts %}
<script type="text/javascript">
    $.getJSON(location.href + ".json", function (response) {
        var app = new arguman.Map({
            model: response.nodes,
            container: "#app"
        });

        app.contention.onRender(function () {
            $(".sticky-header").width(Math.max(
                    app.canvas.domElement.width,
                    window.innerWidth
            ));
        });

        app.render();

    });
</script>
{% endblock %}